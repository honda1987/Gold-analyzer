<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÜ Gold Realtime Analyzer Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .controls select, .controls button {
            padding: 12px 20px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .controls select {
            background: white;
        }
        
        .controls button {
            background: #667eea;
            color: white;
            font-weight: bold;
        }
        
        .controls button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .controls button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .status {
            flex: 1;
            text-align: right;
            color: #666;
            font-size: 14px;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .price-display {
            font-size: 3em;
            font-weight: bold;
            color: #333;
            margin: 20px 0;
        }
        
        .change {
            font-size: 1.5em;
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 8px;
            display: inline-block;
        }
        
        .change.positive {
            color: #10b981;
            background: #d1fae5;
        }
        
        .change.negative {
            color: #ef4444;
            background: #fee2e2;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .metric:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            color: #666;
            font-weight: 500;
        }
        
        .metric-value {
            font-weight: bold;
            color: #333;
        }
        
        .indicator {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .indicator.bullish {
            background: #d1fae5;
            border-left: 4px solid #10b981;
        }
        
        .indicator.bearish {
            background: #fee2e2;
            border-left: 4px solid #ef4444;
        }
        
        .indicator.neutral {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 18px;
        }
        
        .thai-gold {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .thai-price {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .thai-price-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .thai-price-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        
        .order-book {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }
        
        .order-side {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
        }
        
        .order-side h3 {
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .order-side.bids h3 {
            color: #10b981;
        }
        
        .order-side.asks h3 {
            color: #ef4444;
        }
        
        .order-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            padding: 8px;
            font-size: 14px;
            border-bottom: 1px solid #e5e7eb;
            position: relative;
        }
        
        .order-row:last-child {
            border-bottom: none;
        }
        
        .order-header {
            font-weight: bold;
            color: #666;
            background: #f1f5f9;
            border-radius: 4px;
            margin-bottom: 5px;
        }
        
        .order-price {
            font-weight: bold;
        }
        
        .bids .order-price {
            color: #10b981;
        }
        
        .asks .order-price {
            color: #ef4444;
        }
        
        .order-bar {
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            opacity: 0.1;
            z-index: 0;
        }
        
        .bids .order-bar {
            background: #10b981;
        }
        
        .asks .order-bar {
            background: #ef4444;
        }
        
        .order-row > * {
            position: relative;
            z-index: 1;
        }
        
        .spread-info {
            background: #fef3c7;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
        }
        
        .spread-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .spread-value {
            font-size: 20px;
            font-weight: bold;
            color: #f59e0b;
        }

        .github-link {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            text-decoration: none;
            color: #333;
            font-weight: bold;
            transition: all 0.3s;
            z-index: 1000;
        }

        .github-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.6;
            }
        }
    </style>
</head>
<body>
    <a href="#" class="github-link" onclick="showNotification('‚≠ê ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Gold Analyzer Pro!', 'success'); return false;">
        ‚≠ê GitHub
    </a>

    <div class="container">
        <div class="header">
            <h1>üèÜ Gold Realtime Analyzer Pro</h1>
            <p>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå‡∏û‡∏£‡πâ‡∏≠‡∏° Order Book</p>
        </div>
        
        <div class="controls">
            <select id="symbolSelect">
                <option value="XAUUSD">Gold/USD (XAU/USD)</option>
                <option value="BTCUSD">Bitcoin/USD</option>
                <option value="ETHUSD">Ethereum/USD</option>
            </select>
            
            <select id="intervalSelect">
                <option value="1m">1 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                <option value="5m" selected>5 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                <option value="15m">15 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
                <option value="1h">1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
            </select>
            
            <button id="refreshBtn" onclick="fetchAllData()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
            <button id="autoRefreshBtn" onclick="toggleAutoRefresh()">‚ñ∂Ô∏è Auto Refresh</button>
            
            <div class="status" id="status">
                <div>‚è∞ <span id="lastUpdate">-</span></div>
            </div>
        </div>
        
        <div class="dashboard">
            <div class="card">
                <h2>üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h2>
                <div id="priceCard" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
            </div>
            
            <div class="card">
                <h2>üìä ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</h2>
                <div id="changeCard" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
            </div>
            
            <div class="card">
                <h2>üìà Technical Indicators</h2>
                <div id="indicatorCard" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
            </div>
            
            <div class="card">
                <h2>üéØ ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°</h2>
                <div id="trendCard" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
            </div>
        </div>

        <div class="card">
            <h2>üìñ Order Book (‡∏™‡∏°‡∏°‡∏∏‡∏ï‡∏¥)</h2>
            <div id="orderBookCard" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
        </div>
        
        <div class="card">
            <h2>üìâ ‡∏Å‡∏£‡∏≤‡∏ü‡∏£‡∏≤‡∏Ñ‡∏≤</h2>
            <div class="chart-container">
                <canvas id="priceChart"></canvas>
            </div>
        </div>
        
        <div class="card">
            <h2>üáπüá≠ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥‡πÑ‡∏ó‡∏¢</h2>
            <div id="thaiGoldCard" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
        </div>
    </div>

    <script>
        let autoRefreshInterval = null;
        let priceChart = null;
        let currentPrice = 0;
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì RSI
        function calculateRSI(prices, period = 14) {
            if (prices.length < period) return 50;
            
            let gains = 0;
            let losses = 0;
            
            for (let i = prices.length - period; i < prices.length; i++) {
                const change = prices[i] - prices[i - 1];
                if (change > 0) gains += change;
                else losses += Math.abs(change);
            }
            
            const avgGain = gains / period;
            const avgLoss = losses / period;
            
            if (avgLoss === 0) return 100;
            const rs = avgGain / avgLoss;
            return 100 - (100 / (1 + rs));
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì SMA
        function calculateSMA(prices, period) {
            if (prices.length < period) return prices[prices.length - 1];
            const slice = prices.slice(-period);
            return slice.reduce((a, b) => a + b, 0) / period;
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á Order Book ‡∏™‡∏°‡∏°‡∏∏‡∏ï‡∏¥
        function generateOrderBook(basePrice) {
            const bids = [];
            const asks = [];
            const levels = 10;
            const spread = basePrice * 0.0001;
            
            for (let i = 0; i < levels; i++) {
                const price = basePrice - spread - (i * spread * 0.5);
                const size = Math.random() * 10 + 1;
                const total = price * size;
                bids.push({ price, size, total });
            }
            
            for (let i = 0; i < levels; i++) {
                const price = basePrice + spread + (i * spread * 0.5);
                const size = Math.random() * 10 + 1;
                const total = price * size;
                asks.push({ price, size, total });
            }
            
            return { bids, asks, spread: asks[0].price - bids[0].price };
        }

        // ‡πÅ‡∏™‡∏î‡∏á Order Book
        function updateOrderBook(basePrice) {
            const { bids, asks, spread } = generateOrderBook(basePrice);
            const maxBidTotal = Math.max(...bids.map(b => b.total));
            const maxAskTotal = Math.max(...asks.map(a => a.total));
            
            let html = `
                <div class="spread-info">
                    <div class="spread-label">Spread</div>
                    <div class="spread-value">$${spread.toFixed(2)}</div>
                </div>
                <div class="order-book">
                    <div class="order-side bids">
                        <h3>üü¢ Bids (‡∏ã‡∏∑‡πâ‡∏≠)</h3>
                        <div class="order-row order-header">
                            <span>‡∏£‡∏≤‡∏Ñ‡∏≤</span>
                            <span>‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì</span>
                            <span>‡∏£‡∏ß‡∏°</span>
                        </div>
            `;
            
            bids.forEach(bid => {
                const barWidth = (bid.total / maxBidTotal) * 100;
                html += `
                    <div class="order-row">
                        <div class="order-bar" style="width: ${barWidth}%"></div>
                        <span class="order-price">$${bid.price.toFixed(2)}</span>
                        <span>${bid.size.toFixed(3)}</span>
                        <span>$${bid.total.toFixed(2)}</span>
                    </div>
                `;
            });
            
            html += `
                    </div>
                    <div class="order-side asks">
                        <h3>üî¥ Asks (‡∏Ç‡∏≤‡∏¢)</h3>
                        <div class="order-row order-header">
                            <span>‡∏£‡∏≤‡∏Ñ‡∏≤</span>
                            <span>‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì</span>
                            <span>‡∏£‡∏ß‡∏°</span>
                        </div>
            `;
            
            asks.forEach(ask => {
                const barWidth = (ask.total / maxAskTotal) * 100;
                html += `
                    <div class="order-row">
                        <div class="order-bar" style="width: ${barWidth}%"></div>
                        <span class="order-price">$${ask.price.toFixed(2)}</span>
                        <span>${ask.size.toFixed(3)}</span>
                        <span>$${ask.total.toFixed(2)}</span>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;
            
            document.getElementById('orderBookCard').innerHTML = html;
        }
        
        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Metals.Dev API
        async function fetchGoldData() {
            const symbol = document.getElementById('symbolSelect').value;
            const refreshBtn = document.getElementById('refreshBtn');
            
            refreshBtn.disabled = true;
            refreshBtn.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';
            
            try {
                const apiKey = 'U8BZFRTY1XRT3J4HXGBT2364H';
                
                let metal = 'gold';
                if (symbol === 'BTCUSD' || symbol === 'ETHUSD') {
                    useFallbackData();
                    refreshBtn.disabled = false;
                    refreshBtn.textContent = 'üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä';
                    return;
                }
                
                const spotResponse = await fetch(
                    `https://api.metals.dev/v1/metal/spot?api_key=${apiKey}&metal=${metal}&currency=USD`,
                    {
                        headers: {
                            'Accept': 'application/json'
                        }
                    }
                );
                
                if (!spotResponse.ok) {
                    console.log('API Error, using fallback');
                    throw new Error('API Error');
                }
                
                const spotData = await spotResponse.json();
                
                if (!spotData || !spotData.rate) {
                    throw new Error('Invalid API Response');
                }
                
                const rate = spotData.rate;
                currentPrice = rate.price || rate.bid || 2650;
                const openPrice = currentPrice + (rate.change || 0);
                const highPrice = rate.high || currentPrice;
                const lowPrice = rate.low || currentPrice;
                const dayChange = rate.change || 0;
                const dayChangePct = rate.change_percent || 0;
                
                const prices = [];
                const volumes = [];
                const priceRange = highPrice - lowPrice;
                const steps = 30;
                
                for (let i = 0; i < steps; i++) {
                    const ratio = i / (steps - 1);
                    const price = lowPrice + (currentPrice - lowPrice) * ratio + 
                                 (Math.random() - 0.5) * priceRange * 0.1;
                    prices.push(price);
                    volumes.push(Math.random() * 1000 + 500);
                }
                
                const rsi = calculateRSI(prices);
                const sma20 = calculateSMA(prices, Math.min(20, prices.length));
                const avgVolume = volumes.reduce((a, b) => a + b, 0) / volumes.length;
                const currentVolume = volumes[volumes.length - 1];
                
                const fromHighPct = ((currentPrice - highPrice) / highPrice) * 100;
                const fromLowPct = ((currentPrice - lowPrice) / lowPrice) * 100;
                const aboveSMA20Pct = ((currentPrice - sma20) / sma20) * 100;
                const volumeChangePct = ((currentVolume - avgVolume) / avgVolume) * 100;
                
                updatePriceCard(symbol, currentPrice, dayChange, dayChangePct);
                updateChangeCard(openPrice, highPrice, lowPrice, fromHighPct, fromLowPct);
                updateIndicatorCard(rsi, aboveSMA20Pct, volumeChangePct);
                updateTrendCard(dayChangePct, aboveSMA20Pct, rsi, volumeChangePct);
                updateChart(prices);
                updateOrderBook(currentPrice);
                
                await fetchThaiGoldPrice();
                
                console.log('API Response:', spotData);
                console.log('Current Price:', currentPrice);
                console.log('Change:', dayChange, '(', dayChangePct, '%)');
                
                document.getElementById('lastUpdate').innerHTML = `
                    <div style="color: #10b981;">‚úÖ ${new Date().toLocaleTimeString('th-TH')}</div>
                    <div style="font-size: 11px; color: #666;">API: Metals.Dev</div>
                `;
                
            } catch (error) {
                console.error('Error:', error);
                useFallbackData();
            }
            
            refreshBtn.disabled = false;
            refreshBtn.textContent = 'üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä';
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á
        function useFallbackData() {
            const symbol = document.getElementById('symbolSelect').value;
            const basePrice = symbol === 'XAUUSD' ? 4005.985 : 
                             symbol === 'BTCUSD' ? 67500 : 3200;
            
            currentPrice = basePrice;
            const prices = [];
            const volumes = [];
            let price = basePrice;
            
            for (let i = 0; i < 30; i++) {
                price = price + (Math.random() - 0.5) * (basePrice * 0.003);
                prices.push(price);
                volumes.push(Math.random() * 1000 + 500);
            }
            
            const openPrice = basePrice + 106.54;
            const highPrice = Math.max(...prices, basePrice * 1.02);
            const lowPrice = Math.min(...prices, basePrice * 0.98);
            const rsi = calculateRSI(prices);
            const sma20 = calculateSMA(prices, 20);
            const avgVolume = volumes.reduce((a, b) => a + b, 0) / volumes.length;
            const currentVolume = volumes[volumes.length - 1];
            
            const dayChange = -106.54;
            const dayChangePct = -2.59;
            const fromHighPct = ((currentPrice - highPrice) / highPrice) * 100;
            const fromLowPct = ((currentPrice - lowPrice) / lowPrice) * 100;
            const aboveSMA20Pct = ((currentPrice - sma20) / sma20) * 100;
            const volumeChangePct = ((currentVolume - avgVolume) / avgVolume) * 100;
            
            updatePriceCard(symbol, currentPrice, dayChange, dayChangePct);
            updateChangeCard(openPrice, highPrice, lowPrice, fromHighPct, fromLowPct);
            updateIndicatorCard(rsi, aboveSMA20Pct, volumeChangePct);
            updateTrendCard(dayChangePct, aboveSMA20Pct, rsi, volumeChangePct);
            updateChart(prices);
            updateOrderBook(currentPrice);
            
            document.getElementById('thaiGoldCard').innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div style="color: #f59e0b; margin-bottom: 10px;">‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API ‡πÑ‡∏î‡πâ</div>
                    <div style="font-size: 14px; color: #666;">‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</div>
                    <div style="margin-top: 15px; padding: 15px; background: #fef3c7; border-radius: 8px;">
                        <div style="font-size: 12px; color: #666;">
                            üí° ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ:<br>
                            ‚Ä¢ API Rate Limit (100 requests/month)<br>
                            ‚Ä¢ ‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£<br>
                            ‚Ä¢ API Key ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('lastUpdate').innerHTML = `
                <div style="color: #f59e0b;">‚ö†Ô∏è ${new Date().toLocaleTimeString('th-TH')}</div>
                <div style="font-size: 11px; color: #666;">‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏≥‡∏£‡∏≠‡∏á</div>
            `;
        }
        
        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥‡πÑ‡∏ó‡∏¢
        async function fetchThaiGoldPrice() {
            try {
                const usdToThb = 35.5;
                const ounceToBaht = 15.244;
                
                const goldBarPerOz = currentPrice * usdToThb;
                const goldBarPerBaht = goldBarPerOz / ounceToBaht;
                const goldOrnament = goldBarPerBaht + 400;
                
                const goldBarBuy = goldBarPerBaht - 50;
                const goldBarSell = goldBarPerBaht + 50;
                const ornamentBuy = goldOrnament - 50;
                const ornamentSell = goldOrnament + 50;
                
                document.getElementById('thaiGoldCard').innerHTML = `
                    <div style="background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); padding: 15px; border-radius: 12px; margin-bottom: 15px;">
                        <div style="text-align: center; color: #854d0e; font-weight: bold; font-size: 18px; margin-bottom: 10px;">
                            ü•á ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥‡πÑ‡∏ó‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                        </div>
                        <div style="text-align: center; font-size: 12px; color: #92400e;">
                            ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: ${new Date().toLocaleTimeString('th-TH')}
                        </div>
                    </div>
                    
                    <div class="thai-gold">
                        <div class="thai-price" style="border: 2px solid #fbbf24;">
                            <div class="thai-price-label" style="font-weight: bold; color: #92400e;">üí∞ ‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ó‡πà‡∏á 96.5%</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                                <div>
                                    <div style="font-size: 12px; color: #666;">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠</div>
                                    <div style="font-size: 20px; font-weight: bold; color: #10b981;">
                                        ‡∏ø${goldBarBuy.toLocaleString('th-TH', {maximumFractionDigits: 0})}
                                    </div>
                                </div>
                                <div>
                                    <div style="font-size: 12px; color: #666;">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</div>
                                    <div style="font-size: 20px; font-weight: bold; color: #ef4444;">
                                        ‡∏ø${ornamentSell.toLocaleString('th-TH', {maximumFractionDigits: 0})}
                                    </div>
                                </div>
                            </div>
                            <div style="font-size: 11px; color: #666; margin-top: 8px; padding-top: 8px; border-top: 1px solid #e5e7eb;">
                                ‡∏ï‡πà‡∏≠‡∏ö‡∏≤‡∏ó (‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á)
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; padding: 12px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 13px;">
                            <div>
                                <span style="color: #666;">üíµ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏≤‡∏Å‡∏•:</span>
                                <strong style="color: #333;"> $${currentPrice.toFixed(2)}/oz</strong>
                            </div>
                            <div>
                                <span style="color: #666;">üí± ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô:</span>
                                <strong style="color: #333;"> ‡∏ø${usdToThb}</strong>
                            </div>
                        </div>
                        <div style="font-size: 11px; color: #92400e; margin-top: 8px; text-align: center;">
                            ‚ÑπÔ∏è ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏ï‡∏•‡∏≤‡∏î‡πÇ‡∏•‡∏Å ‡∏≠‡∏≤‡∏à‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('thaiGoldCard').innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #ef4444;">
                        ‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≠‡∏á‡πÑ‡∏ó‡∏¢‡πÑ‡∏î‡πâ
                    </div>
                `;
            }
        }
        
        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤
        function updatePriceCard(symbol, price, change, changePct) {
            const changeClass = change >= 0 ? 'positive' : 'negative';
            const changeSymbol = change >= 0 ? 'üü¢ +' : 'üî¥ ';
            
            document.getElementById('priceCard').innerHTML = `
                <div class="price-display">$${price.toFixed(2)}</div>
                <div class="change ${changeClass}">
                    ${changeSymbol}${Math.abs(change).toFixed(2)} (${changePct.toFixed(2)}%)
                </div>
            `;
        }
        
        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
        function updateChangeCard(open, high, low, fromHighPct, fromLowPct) {
            document.getElementById('changeCard').innerHTML = `
                <div class="metric">
                    <span class="metric-label">‡πÄ‡∏õ‡∏¥‡∏î</span>
                    <span class="metric-value">$${open.toFixed(2)}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</span>
                    <span class="metric-value">$${high.toFixed(2)}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î</span>
                    <span class="metric-value">$${low.toFixed(2)}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏à‡∏∏‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</span>
                    <span class="metric-value">${fromHighPct.toFixed(2)}%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏à‡∏∏‡∏î‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î</span>
                    <span class="metric-value">+${fromLowPct.toFixed(2)}%</span>
                </div>
            `;
        }
        
        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡πå‡∏î Indicators
        function updateIndicatorCard(rsi, aboveSMA20Pct, volumeChangePct) {
            const rsiClass = rsi > 70 ? 'bearish' : rsi < 30 ? 'bullish' : 'neutral';
            const smaClass = aboveSMA20Pct > 0 ? 'bullish' : 'bearish';
            const volClass = volumeChangePct > 20 ? 'bullish' : volumeChangePct < -20 ? 'bearish' : 'neutral';
            
            document.getElementById('indicatorCard').innerHTML = `
                <div class="indicator ${rsiClass}">
                    <span>RSI (14)</span>
                    <span><strong>${rsi.toFixed(2)}</strong></span>
                </div>
                <div class="indicator ${smaClass}">
                    <span>‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö SMA(20)</span>
                    <span><strong>${aboveSMA20Pct > 0 ? '+' : ''}${aboveSMA20Pct.toFixed(2)}%</strong></span>
                </div>
                <div class="indicator ${volClass}">
                    <span>Volume vs ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</span>
                    <span><strong>${volumeChangePct > 0 ? '+' : ''}${volumeChangePct.toFixed(2)}%</strong></span>
                </div>
            `;
        }
        
        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°
        function updateTrendCard(dayChangePct, aboveSMA20Pct, rsi, volumeChangePct) {
            let signals = [];
            
            if (dayChangePct > 0) signals.push('üìà ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô');
            else signals.push('üìâ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏•‡∏á');
            
            if (aboveSMA20Pct > 2) signals.push('üü¢ ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ SMA');
            else if (aboveSMA20Pct < -2) signals.push('üî¥ ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ï‡πâ SMA');
            else signals.push('üü° ‡πÉ‡∏Å‡∏•‡πâ SMA');
            
            if (rsi > 70) signals.push('‚ö†Ô∏è Overbought');
            else if (rsi < 30) signals.push('‚úÖ Oversold');
            else signals.push('‚ûñ RSI ‡∏õ‡∏Å‡∏ï‡∏¥');
            
            if (volumeChangePct > 20) signals.push('üîä Volume ‡∏™‡∏π‡∏á');
            else if (volumeChangePct < -20) signals.push('üîá Volume ‡∏ï‡πà‡∏≥');
            
            let bullishCount = 0;
            let bearishCount = 0;
            
            if (dayChangePct > 0) bullishCount++;
            else bearishCount++;
            
            if (aboveSMA20Pct > 0) bullishCount++;
            else bearishCount++;
            
            if (rsi < 50) bullishCount++;
            else bearishCount++;
            
            const overallTrend = bullishCount > bearishCount ? 'bullish' : 
                                bullishCount < bearishCount ? 'bearish' : 'neutral';
            const trendText = overallTrend === 'bullish' ? 'üü¢ ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Ç‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô' :
                             overallTrend === 'bearish' ? 'üî¥ ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Ç‡∏≤‡∏•‡∏á' : 'üü° ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÜ';
            
            document.getElementById('trendCard').innerHTML = `
                <div class="indicator ${overallTrend}" style="margin-bottom: 15px;">
                    <span style="font-size: 1.2em; font-weight: bold;">${trendText}</span>
                </div>
                ${signals.map(signal => `
                    <div class="metric">
                        <span>${signal}</span>
                    </div>
                `).join('')}
            `;
        }
        
        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏£‡∏≤‡∏ü
        function updateChart(prices) {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            if (priceChart) {
                priceChart.destroy();
            }
            
            const labels = prices.map((_, i) => i + 1);
            
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '‡∏£‡∏≤‡∏Ñ‡∏≤',
                        data: prices,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 0,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return '$' + context.parsed.y.toFixed(2);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: false
                        },
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(0);
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Auto Refresh
        function toggleAutoRefresh() {
            const btn = document.getElementById('autoRefreshBtn');
            
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
                btn.textContent = '‚ñ∂Ô∏è Auto Refresh';
                btn.style.background = '#667eea';
            } else {
                const interval = 60000;
                autoRefreshInterval = setInterval(fetchAllData, interval);
                btn.textContent = '‚è∏Ô∏è ‡∏´‡∏¢‡∏∏‡∏î Refresh';
                btn.style.background = '#10b981';
                fetchAllData();
                
                showNotification('‡πÄ‡∏õ‡∏¥‡∏î Auto Refresh ‡πÅ‡∏•‡πâ‡∏ß (‡∏ó‡∏∏‡∏Å 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)', 'success');
            }
        }
        
        // ‡πÅ‡∏™‡∏î‡∏á notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#667eea'};
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
                max-width: 300px;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        async function fetchAllData() {
            await fetchGoldData();
        }
        
        // Event Listeners
        document.getElementById('symbolSelect').addEventListener('change', () => {
            fetchAllData();
        });
        
        document.getElementById('intervalSelect').addEventListener('change', () => {
            const interval = document.getElementById('intervalSelect').value;
            showNotification(`‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô ${interval} ‡πÅ‡∏•‡πâ‡∏ß`, 'info');
            fetchAllData();
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'r' || e.key === 'R') {
                e.preventDefault();
                fetchAllData();
                showNotification('üîÑ Refreshing...', 'info');
            }
            
            if (e.key === ' ' && e.target.tagName !== 'INPUT') {
                e.preventDefault();
                toggleAutoRefresh();
            }
        });
        
        // Network Status
        window.addEventListener('online', () => {
            showNotification('‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡πÅ‡∏•‡πâ‡∏ß', 'success');
            fetchAllData();
        });
        
        window.addEventListener('offline', () => {
            showNotification('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï', 'error');
        });
        
        // Visibility API
        document.addEventListener('visibilitychange', () => {
            if (document.hidden && autoRefreshInterval) {
                console.log('Page hidden - pausing auto refresh');
            } else if (!document.hidden && autoRefreshInterval) {
                console.log('Page visible - resuming auto refresh');
                fetchAllData();
            }
        });
        
        // Error boundary
        window.addEventListener('error', (e) => {
            console.error('Global error:', e);
            showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà', 'error');
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            console.error('Unhandled promise rejection:', e);
        });
        
        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        window.addEventListener('DOMContentLoaded', () => {
            showNotification('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'info');
            fetchAllData();
            
            setTimeout(() => {
                showNotification('üí° Tip: ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° Auto Refresh ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥', 'info');
            }, 5000);
        });
    </script>
</body>
</html>
                                    <div style="font-size: 20px; font-weight: bold; color: #ef4444;">
                                        ‡∏ø${goldBarSell.toLocaleString('th-TH', {maximumFractionDigits: 0})}
                                    </div>
                                </div>
                            </div>
                            <div style="font-size: 11px; color: #666; margin-top: 8px; padding-top: 8px; border-top: 1px solid #e5e7eb;">
                                ‡∏ï‡πà‡∏≠‡∏ö‡∏≤‡∏ó (15.244 ‡∏Å‡∏£‡∏±‡∏°)
                            </div>
                        </div>
                        
                        <div class="thai-price" style="border: 2px solid #f59e0b;">
                            <div class="thai-price-label" style="font-weight: bold; color: #92400e;">üíé ‡∏ó‡∏≠‡∏á‡∏£‡∏π‡∏õ‡∏û‡∏£‡∏£‡∏ì 96.5%</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                                <div>
                                    <div style="font-size: 12px; color: #666;">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠</div>
                                    <div style="font-size: 20px; font-weight: bold; color: #10b981;">
                                        ‡∏ø${ornamentBuy.toLocaleString('th-TH', {maximumFractionDigits: 0})}
                                    </div>
                                </div>
                                <div>
                                    <div style="font-size: 12px; color: #666;">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</div>